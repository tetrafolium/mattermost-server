---
inspecode:

  global:
    ignore:
      - "vendor/"
    runtime:
      go: 1.14          # from "./go.mod" ... using "hash/maphash", etc.

  experimental:
    env:
      GO111MODULE: auto

  tasks:

    - name: dockerfilelint
      type: docker-build
      dockerfile: "inspecode-dockerfilelint.Dockerfile"
      options: {--build-arg: OUTDIR=/.reports}
      reports:
        - {from: dockerfilelint-task, path: "/.reports/dockerfilelint.sarif"}
      thresholds: {num-issues: 999}

    # - name: hadolint
    #   type: docker-build
    #   dockerfile: "inspecode-hadolint.Dockerfile"
    #   options:
    #     --build-arg:
    #       OUTDIR=/.reports
    #   artifacts:
    #     - from: hadolint-task
    #       path: "/.reports/hadolint.json"
    #     - from: hadolint-task
    #       path: "/.reports/hadolint.sarif"
    #   reports:
    #     - from: hadolint-task
    #       path: "/.reports/hadolint.sarif"
    #   thresholds: {num-issues: 34}

    - name: hadolint_alp_go112
      type: docker-build
      dockerfile: "inspecode-hadolint.alpine312+go112.Dockerfile"
      options: {--build-arg: OUTDIR=/.reports}
      reports:
        - {from: hadolint-task, path: "/.reports/hadolint.sarif"}
      thresholds: {num-issues: 999}
      ## ERROR: unsatisfiable constraints: go-1.13.15-r0: breaks: world[go=1.12.17-r0]

    - name: hadolint_alp_go113
      type: docker-build
      dockerfile: "inspecode-hadolint.alpine312+go113.Dockerfile"
      options: {--build-arg: OUTDIR=/.reports}
      reports:
        - {from: hadolint-task, path: "/.reports/hadolint.sarif"}
      thresholds: {num-issues: 999}

    - name: hadolint_alp_go114
      type: docker-build
      dockerfile: "inspecode-hadolint.alpine312+go114.Dockerfile"
      options: {--build-arg: OUTDIR=/.reports}
      reports:
        - {from: hadolint-task, path: "/.reports/hadolint.sarif"}
      thresholds: {num-issues: 999}

    - name: hadolint_go114
      type: docker-build
      dockerfile: "inspecode-hadolint.golang114.Dockerfile"
      options: {--build-arg: OUTDIR=/.reports}
      reports:
        - {from: hadolint-task, path: "/.reports/hadolint.sarif"}
      thresholds: {num-issues: 999}
      ## cannot find package "." in: /.go/src/github.com/tetrafolium/mattermost-server/vendor/github.com/tetrafolium/inspecode-tasks/{hadolint/{convert,parse},sarif}

    - name: hadolint_go115
      type: docker-build
      dockerfile: "inspecode-hadolint.golang115.Dockerfile"
      options: {--build-arg: OUTDIR=/.reports}
      reports:
        - {from: hadolint-task, path: "/.reports/hadolint.sarif"}
      thresholds: {num-issues: 999}
      ## cannot find package "." in: /.go/src/github.com/tetrafolium/mattermost-server/vendor/github.com/tetrafolium/inspecode-tasks/{hadolint/{convert,parse},sarif}
