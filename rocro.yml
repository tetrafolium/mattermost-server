---
inspecode:

  global:
    ignore:
      - "vendor/"
    runtime:
      go: 1.14          # from "./go.mod" ... using "hash/maphash", etc.

  experimental:
    env:
      GO111MODULE: auto

  tasks:

    - name: dockerfilelint
      type: docker-build
      dockerfile: "inspecode-dockerfilelint.Dockerfile"
      options: {--build-arg: OUTDIR=/.reports}
      reports:
        - {from: dockerfilelint-task, path: "/.reports/dockerfilelint.sarif"}
      thresholds: {num-issues: 999}

    # - name: hadolint
    #   type: docker-build
    #   dockerfile: "inspecode-hadolint.Dockerfile"
    #   options:
    #     --build-arg:
    #       OUTDIR=/.reports
    #   artifacts:
    #     - from: hadolint-task
    #       path: "/.reports/hadolint.json"
    #     - from: hadolint-task
    #       path: "/.reports/hadolint.sarif"
    #   reports:
    #     - from: hadolint-task
    #       path: "/.reports/hadolint.sarif"
    #   thresholds: {num-issues: 34}

    - name: hadolint_alp_go112
      type: docker-build
      dockerfile: "inspecode-hadolint.alpine312+go112.Dockerfile"
      options: {--build-arg: OUTDIR=/.reports}
      reports:
        - {from: hadolint-task, path: "/.reports/hadolint.sarif"}
      thresholds: {num-issues: 34}

    - name: hadolint_alp_go113
      type: docker-build
      dockerfile: "inspecode-hadolint.alpine312+go113.Dockerfile"
      options: {--build-arg: OUTDIR=/.reports}
      reports:
        - {from: hadolint-task, path: "/.reports/hadolint.sarif"}
      thresholds: {num-issues: 34}

    - name: hadolint_go114
      type: docker-build
      dockerfile: "inspecode-hadolint.golang114.Dockerfile"
      options: {--build-arg: OUTDIR=/.reports}
      reports:
        - {from: hadolint-task, path: "/.reports/hadolint.sarif"}
      thresholds: {num-issues: 34}

    - name: hadolint_go115
      type: docker-build
      dockerfile: "inspecode-hadolint.golang115.Dockerfile"
      options: {--build-arg: OUTDIR=/.reports}
      reports:
        - {from: hadolint-task, path: "/.reports/hadolint.sarif"}
      thresholds: {num-issues: 34}
